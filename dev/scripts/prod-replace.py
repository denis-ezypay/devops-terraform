load_balancers = {
  'internal-staging-IAM-internal-api01-417529720.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-IAM-internal-api01-747087175.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-admin-568817578.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-admin-837549507.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-api01-227614105.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-api01-342662238.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-api02-1486975099.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-api02-1721326139.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-app-gateway-361284312.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-app-gateway-1366974073.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-config-735628926.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-config-729780825.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-gateway-219625279.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-gateway-1154281202.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-rabbitmq-720511187.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-rabbitmq-708933320.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-ui01-525299542.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-ui01-777740797.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-internal-ui02-1495888575.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-internal-ui02-86646595.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-vault-internal-api01-1591956655.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-vault-internal-api01-224321196.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-vault-internal-config-960387224.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-vault-internal-config-227601168.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-vault-internal-engine-1136690252.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-vault-internal-engine-593273990.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-vault-internal-gateway-1407945316.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-vault-internal-gateway-1483324898.ap-southeast-2.elb.amazonaws.com',
  'internal-staging-vault-internal-ui01-1902220.ap-southeast-2.elb.amazonaws.com': 'internal-sydney-vault-internal-ui01-695828916.ap-southeast-2.elb.amazonaws.com',
  'staging-external-ezypay-1959365723.ap-southeast-2.elb.amazonaws.com': 'sydney-external-ezypay-1696926511.ap-southeast-2.elb.amazonaws.com',
  'staging-IAM-external-ezypay-379811105.ap-southeast-2.elb.amazonaws.com': 'sydney-IAM-external-ezypay-1636351860.ap-southeast-2.elb.amazonaws.com',
  'staging-vault-external-ezypay-1649284086.ap-southeast-2.elb.amazonaws.com': 'sydney-vault-external-ezypay-864209565.ap-southeast-2.elb.amazonaws.com',
}

acls = {
  '"acl-5a74423e"': '"acl-05f49e61"',
  '"acl-3875435c"': '"acl-23333f46"',
  '"acl-a07543c4"': '"acl-4910ae2d"',
  '"acl-62754306"': '"acl-70328c14"',
  '"acl-d57442b1"': '"acl-80eb51e4"',
  '"acl-dd7046b9"': '"acl-7fcaa01b"',
  '"acl-2d744249"': '"acl-d0f59fb4"',
  '"acl-0c754368"': '"acl-312d9355"',
  '"acl-4e72442a"': '"acl-79338d1d"',
  '"acl-32744256"': '"acl-8feb51eb"',
  '"acl-7f75431b"': '"acl-88eb51ec"',
  '"acl-7975431d"': '"acl-5c10ae38"',
  '"acl-0e72446a"': '"acl-5310ae37"'
}

security_groups = {
  '"sg-ad457cca"': '"sg-ab30f7cc"',
  '"sg-05457c62"': '"sg-6cd12b0b"',
  '"sg-17477e70"': '"sg-761c9c12"',
  '"sg-90427bf7"': '"sg-caad38ad"',
  '"sg-f7427b90"': '"sg-ceed12a9"',
  '"sg-76477e11"': '"sg-d538c7b2"',
  '"sg-da447dbd"': '"sg-c67deaa1"',
  '"sg-d9457cbe"': '"sg-647ee903"',
  '"sg-bd477eda"': '"sg-9d79eefa"',
  '"sg-3f447d58"': '"sg-f07ceb97"',
  '"sg-f0427b97"': '"sg-fd7aed9a"',
  '"sg-b0477ed7"': '"sg-9571e6f2"',
  '"sg-f1427b96"': '"sg-6a02950d"',
  '"sg-d8447dbf"': '"sg-a470e7c3"',
  '"sg-d9447dbe"': '"sg-ce6212a9"',
  '"sg-70447d17"': '"sg-247dea43"',
  '"sg-9e427bf9"': '"sg-0bf0b66c"',
  '"sg-30447d57"': '"sg-93f84df4"',
  '"sg-74447d13"': '"sg-42572225"',
  '"sg-14477e73"': '"sg-cd8026aa"',
  '"sg-c6d13ea0"': '"sg-2335c245"',
  '"sg-05447d62"': '"sg-7f669c18"',
  '"sg-44447d23"': '"sg-cd6399aa"',
  '"sg-a4447dc3"': '"sg-83609ae4"',
  '"sg-45447d22"': '"sg-f6448091"',
  '"sg-bb477edc"': '"sg-c86818af"',
  '"sg-ee477e89"': '"sg-9feb28f8"',
  '"sg-13477e74"': '"sg-c67e56a1"',
  '"sg-75447d12"': '"sg-4d70582a"',
  '"sg-b3477ed4"': '"sg-c57e56a2"',
  '"sg-f7d3c790"': '"sg-16584a71"',
  '"sg-22deca45"': '"sg-b9594bde"',
  '"sg-84477ee3"': '"sg-16e42471"',
  '"sg-af457cc8"': '"sg-0ba46c6c"',
  '"sg-a6447dc1"': '"sg-15e42472"',
  '"sg-05435762"': '"sg-1960727e"',
  '"sg-df4357b8"': '"sg-976173f0"',
  '"sg-a2447dc5"': '"sg-946eaaf3"',
  '"sg-07447d60"': '"sg-17e42470"',
  '"sg-39447d5e"': '"sg-12e42475"',
  '"sg-a2457cc5"': '"sg-dba46dbc"',
  '"sg-bc477edb"': '"sg-0fe42468"',
  '"sg-a5447dc2"': '"sg-09e4246e"',
  '"sg-66457c01"': '"sg-14e42473"',
  '"sg-ba477edd"': '"sg-14943173"',
  '"sg-4b467f2c"': '"sg-926eaaf5"',
  '"sg-e2477e85"': '"sg-0ee42469"',
  '"sg-a1447dc6"': '"sg-936eaaf4"',
  '"sg-7a447d1d"': '"sg-10e42477"',
  '"sg-43447d24"': '"sg-8b7ce0ec"',
  '"sg-9f467ff8"': '"sg-13e42474"',
  '"sg-3a447d5d"': '"sg-0be4246c"',
  '"sg-67457c00"': '"sg-beb77cd9"',
  '"sg-fd427b9a"': '"sg-0ae4246d"',
  '"sg-3a4d595d"': '"sg-da6072bd"',
  '"sg-b44e5ad3"': '"sg-c36371a4"',
  '"sg-7c477e1b"': '"sg-0ce4246b"',
  '"sg-a0447dc7"': '"sg-08e4246f"',
  '"sg-54467f33"': '"sg-274db340"',
  '"sg-47477e20"': '"sg-2c4db34b"',
  '"sg-48467f2f"': '"sg-524db335"',
  '"sg-9b467ffc"': '"sg-6a31830d"',
  '"sg-9c467ffb"': '"sg-494db32e"',
  '"sg-ab447dcc"': '"sg-464db321"',
  '"sg-78477e1f"': '"sg-624db305"',
  '"sg-45477e22"': '"sg-8d4cb2ea"',
  '"sg-81477ee6"': '"sg-884cb2ef"',
  '"sg-57467f30"': '"sg-a14cb2c6"',
  '"sg-56467f31"': '"sg-be4cb2d9"',
  '"sg-ec477e8b"': '"sg-d14cb2b6"',
  '"sg-99467ffe"': '"sg-5035ca37"',
  '"sg-b4477ed3"': '"sg-56db2431"',
  '"sg-df457cb8"': '"sg-f7de2190"',
  '"sg-11477e76"': '"sg-6ff10f08"',
  '"sg-b7477ed0"': '"sg-b244bad5"',
  '"sg-b6477ed1"': '"sg-f3dd2294"',
  '"sg-de457cb9"': '"sg-a8c936cf"',
  '"sg-d0457cb7"': '"sg-77de2110"',
  '"sg-73447d14"': '"sg-8236c9e5"',
  '"sg-d1457cb6"': '"sg-6535ca02"',
  '"sg-73477e14"': '"sg-d8de21bf"',
  '"sg-f2427b95"': '"sg-b434cbd3"',
  '"sg-04447d63"': '"sg-084cb26f"',
  '"sg-3c39005b"': '"sg-024cb265"',
  '"sg-41447d26"': '"sg-204cb247"',
  '"sg-ac447dcb"': '"sg-3d4cb25a"',
  '"sg-3d39005a"': '"sg-4d4cb22a"',
  '"sg-70477e17"': '"sg-6cd12b0b"',
  '"sg-4b3b022c"': '"sg-761c9c12"'
}

route_tables = {
  '"rtb-d55e59b1"': '"rtb-0e19676a"',
  '"rtb-6e5d5a0a"': '"rtb-54fb7630"',
  '"rtb-945b5cf0"': '"rtb-7a34b51e"',
  '"rtb-045d5a60"': '"rtb-921091f6"',
  '"rtb-f65b5c92"': '"rtb-f2818b97"',
  '"rtb-a55b5cc1"': '"rtb-3f17695b"',
  '"rtb-865d5ae2"': '"rtb-85433ae1"',
  '"rtb-755a5d11"': '"rtb-33453c57"',
  '"rtb-a55a5dc1"': '"rtb-0f19676b"',
  '"rtb-9c5c5bf8"': '"rtb-53fb7637"',
  '"rtb-a65b5cc2"': '"rtb-5cfb7638"',
  '"rtb-ed5d5a89"': '"rtb-5dfb7639"',
  '"rtb-2860674c"': '"rtb-5efb763a"',
  '"rtb-065b5c62"': '"rtb-2913924d"',
  '"rtb-d55c5bb1"': '"rtb-27139243"',
  '"rtb-255c5b41"': '"rtb-4d34b529"',
  '"rtb-875d5ae3"': '"rtb-4f34b52b"',
  '"rtb-175a5d73"': '"rtb-4e34b52a"',
  '"rtb-e6767182"': '"rtb-4834b52c"',
}

route_table_associations = {
  # cb
  '"rtbassoc-a28af9c5"': '"rtbassoc-4e414a2a"',
  '"rtbassoc-2088fb47"': '"rtbassoc-2fdf074b"',
  '"rtbassoc-9d8af9fa"': '"rtbassoc-5a414a3e"',
  '"rtbassoc-1288fb75"': '"rtbassoc-5f414a3b"',
  '"rtbassoc-c68af9a1"': '"rtbassoc-24414a40"',
  '"rtbassoc-9b8af9fc"': '"rtbassoc-5b414a3f"',
  '"rtbassoc-a889facf"': '"rtbassoc-5e414a3a"',
  '"rtbassoc-aa88fbcd"': '"rtbassoc-5d414a39"',
  '"rtbassoc-14e09373"': '"rtbassoc-58414a3c"',
  '"rtbassoc-22e29145"': '"rtbassoc-59414a3d"',
  '"rtbassoc-4ae7942d"': '"rtbassoc-26414a42"',

  # mgmt
  '"rtbassoc-508af937"': '"rtbassoc-10949874"',
  '"rtbassoc-5f8af938"': '"rtbassoc-6f94980b"',
  '"rtbassoc-048bf863"': '"rtbassoc-389b975c"',

  # vault
  '"rtbassoc-a989face"': '"rtbassoc-fd4e4199"',
  '"rtbassoc-7088fb17"': '"rtbassoc-f14e4195"',
  '"rtbassoc-5e8af939"': '"rtbassoc-f34e4197"',
  '"rtbassoc-7188fb16"': '"rtbassoc-ff4e419b"',
  '"rtbassoc-548ffc33"': '"rtbassoc-f24e4196"',
  '"rtbassoc-3589fa52"': '"rtbassoc-f04e4194"',
  '"rtbassoc-b0e093d7"': '"rtbassoc-f74e4193"',
  '"rtbassoc-3ce1925b"': '"rtbassoc-fe4e419a"',
  '"rtbassoc-b1e093d6"': '"rtbassoc-fc4e4198"',

  # iam
  '"rtbassoc-568ffc31"': '"rtbassoc-c7bb67a0"',
  '"rtbassoc-ac89facb"': '"rtbassoc-caad7fad"',
  '"rtbassoc-ac88fbcb"': '"rtbassoc-bab66add"',
  '"rtbassoc-928af9f5"': '"rtbassoc-d6b864b1"',
  '"rtbassoc-908af9f7"': '"rtbassoc-0fb06c68"',
  '"rtbassoc-ab88fbcc"': '"rtbassoc-e9b66a8e"',
  '"rtbassoc-7488fb13"': '"rtbassoc-8aa87aed"',
  '"rtbassoc-918af9f6"': '"rtbassoc-5db5693a"',
  '"rtbassoc-1588fb72"': '"rtbassoc-47ba6620"',
  # unknown
  '"rtbassoc-c688fba1"': '"rtbassoc-e14e4185"',
  '"rtbassoc-638bf804"': '"rtbassoc-8ba87aec"'
}

subnets = {
  # '': 'subnet-72535505',
  # '': 'subnet-ef8d9ba9',
  # '': 'subnet-fa92889f',
  '"subnet-9c586af8"': '"subnet-36433c52"',
  '"subnet-fd586a99"': '"subnet-d8a7d9bc"',
  '"subnet-6e6e4e18"': '"subnet-cec8a8b8"',
  '"subnet-006c4c76"': '"subnet-9dcbabeb"',
  '"subnet-042d4e5d"': '"subnet-fba810a2"',
  '"subnet-22284b7b"': '"subnet-1db70f44"',
  '"subnet-7f5e6c1b"': '"subnet-b2453ad6"',
  '"subnet-1b6d4d6d"': '"subnet-48c7a73e"',
  '"subnet-812f4cd8"': '"subnet-10b70f49"',
  '"subnet-d5596bb1"': '"subnet-cbdf54af"',
  '"subnet-4e5b692a"': '"subnet-c1df54a5"',
  '"subnet-565b6932"': '"subnet-8ce46fe8"',
  '"subnet-9d586af9"': '"subnet-6658e510"',
  '"subnet-185e6c7c"': '"subnet-8de46fe9"',
  '"subnet-4a5b692e"': '"subnet-6758e511"',
  '"subnet-0d6c4c7b"': '"subnet-1c60f578"',
  '"subnet-5c6d4d2a"': '"subnet-5002b226"',
  '"subnet-266b4b50"': '"subnet-1d60f579"',
  '"subnet-d36b4ba5"': '"subnet-5102b227"',
  '"subnet-202f4c79"': '"subnet-53ea300a"',
  '"subnet-26284b7f"': '"subnet-82ec48db"',
  '"subnet-6a2e4d33"': '"subnet-80ec48d9"',
  '"subnet-6e2e4d37"': '"subnet-51ea3008"',
  '"subnet-0e596b6a"': '"subnet-83e46fe7"',
  '"subnet-455e6c21"': '"subnet-7958e50f"',
  '"subnet-0e6c4c78"': '"subnet-1360f577"',
  '"subnet-b96d4dcf"': '"subnet-5302b225"',
  '"subnet-612f4c38"': '"subnet-83ec48da"',
  '"subnet-862f4cdf"': '"subnet-50ea3009"'
}




vpcs = {
  '"vpc-3a1e6b5e"': '"vpc-4d466628"',
  '"vpc-981f6afc"': '"vpc-e1bc0f85"',
  '"vpc-891d68ed"': '"vpc-5d62af39"',
  '"vpc-f71d6893"': '"vpc-db874bbf"',
  '"vpc-081f6a6c"': '"vpc-4e3cf22a"'
}

peering_connections = {
  '"pcx-4b8b0b22"': '"pcx-be9320d7"',
  '"pcx-228d0d4b"': '"pcx-2f6ddd46"',
  '"pcx-d18a0ab8"': '"pcx-6ce35d05"'
}

internet_gateways = {
  '"igw-8a856bee"': '"igw-47fda522"',
  '"igw-c4856ba0"': '"igw-3b66f65e"',
  '"igw-f5846a91"': '"igw-48a4fa2d"',
  '"igw-84846ae0"': '"igw-eebce28b"',
  '"igw-ae8769ca"': '"igw-ede8d388"'
}

env_names = {
  'staging': 'sydney'
}

all_replacements = {}
all_replacements.update(load_balancers)
all_replacements.update(acls)
all_replacements.update(security_groups)
all_replacements.update(route_tables)
all_replacements.update(route_table_associations)
all_replacements.update(subnets)
all_replacements.update(vpcs)
all_replacements.update(peering_connections)
all_replacements.update(internet_gateways)
all_replacements.update(env_names)

import re
import os
from shutil import copyfile

def replfunc(match):
  actual =  match.group(0)
  print "Replacing {} with {}".format(actual, all_replacements[actual])
  return all_replacements[actual]

input_state = "../terraform.tfstate.d/staging/terraform.tfstate"
output_state = "../terraform.tfstate.d/sydney/terraform.tfstate"

copyfile(input_state, output_state)

for replacement_group in [load_balancers, acls, security_groups, route_tables, route_table_associations, subnets, vpcs, peering_connections, internet_gateways, env_names]:
  regex = re.compile('|'.join(x for x in replacement_group))
  with open(output_state, 'r') as file, open(output_state+'.updated', 'w') as output:
    for line in file:
      output.write(regex.sub(replfunc, line))
  os.remove(output_state)
  os.rename(output_state+'.updated', output_state)
